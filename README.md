# LiDAR and Camera Sensor fusion for Vehicle detection and Tracking

![Demo](https://github.com/nsteve2407/nd013-c2-fusion-starter/blob/main/img/demo.gif)

This project implements LiDAR and Camera late fusion approach for object detection. Camera images are used for generating 2D detections using an SSD detector trained on the Waymo Open Dataset. Vehicles are detected in the LiDAR point clouds using the Complex YOLO detection framework. An Extented Kalman Filter (EKF) is used to fuse measurements from both these sensors to enable multi-target detection and traking.



#### Step 1: Kalman Filter
We estimate and track a 6D state vector consisiting of 3d position and 3d velocities. We use a linear motion model assuming constant velocity as the state transition function. Since the velocities of vehicle are ususally not constat, we assign a high covariance for the initial velocity estimates. For the measurement function we use the lidar detections by transforming them to the vehicle coordinate frame. 
The RMSE for a single vehicle tracking task obtained using only lidar detections as measurements is shown below:
![img1](https://github.com/nsteve2407/nd013-c2-fusion-starter/blob/main/img/Step1-RMSE.png)
#### Step 2: Track Management
We implement a track managemnet strategy to :
1. Reduce the score of tracks which have no detections associted with them. This is done only if the track was within the field of view of the sensor from which the current measurement was generated.

2. Generate new tracks for measurement that have not been associted. We use the lidar measurements along with lidar detection covariances transformed to the vehicle from for initializing these new tracks.
3. Delete tracks based on their state, score and uncertainty.

The results obtained for trakcking of a single vehicle with this track management approach is depicted in the figure below:
![img2](https://github.com/nsteve2407/nd013-c2-fusion-starter/blob/main/img/Step2-RMSE.png)

#### Step 3: Data Association
We use a Simple Nearest Neighbour (SNN) approach to deal with the data assocaition/correspondence problem. Mahalanobis distance is used as the criteria for nearness. We also use gating to ensure that irrelevant matches are avoided.This method is based on the assumption that each track can generate only one measurement. Multi target tracking using only lidar data and data association usig this method yeilded the following results in terms of RMSE:

![img3](https://github.com/nsteve2407/nd013-c2-fusion-starter/blob/main/img/Step3-RMSE.png)

#### Step 4: Camera-Lidar sensor fusion
Camera intrinsic parameters are used to transform predicted tracks into the pixel coordinate frame. Since this is a nonlinear measurement function we linearize the function at the state mean value by calculating the jacobian matrix. Final results from Camera and Lidar fused detections are shown below:

![img4](https://github.com/nsteve2407/nd013-c2-fusion-starter/blob/main/img/Step4-RMSE.png)

#### Advantange of using both camera and lidar?
After adding the camera detections the RMSE of some of the tracks decreased. Also adding the camera detection helps with tracking of distant objects as the are not as well detected in lidar point clouds. It also helps to quckly eliminate False Positive detections generated by the lidar detector.

#### Challenges to real life scenarios
Some challenges with respect to real life scnarios are:
1. Data association: SNN is not the best approach for data association, in which case some detections may be unmatched/mismatched
2. FOV: Objects can be in a transitional area at the edges of the FOV of both sensors, in which case it will not be detected by both sensors.
3. Changing velocities: Real world vehicles have a changin velocity which violates our constant velocity assumption. Hence vehicles making sudden changes in direction will not be tracked as well.

#### Possible improvements:
1. Use a bicycle model for motion prediction in the predict step.
2. Add additional state variables such as length, width, height and yaw.
3. Use better assocaition methods such as GNN/JPDA.
